<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, user-scalable=no,
		shrink-to-fit=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />

  <title>Labb 4</title>

  <style>
    /* @import "ui/css/evothings-app.css"; */
  </style>

  <script>
    // Redirect console.log to Evothings Workbench.
    // if (window.hyper && window.hyper.log) {
    //   console.log = hyper.log;
    // }
  </script>

  <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.21.7.js"></script>
  <!-- <script src="libs/jquery/jquery.js"></script> -->

  <!-- Instantiate PubNub -->

  <script type="text/javascript">
    // $("#firstpage").show();
    // $("#chatroom").hide();
    let username = "UNKNOWN";

    enterChatroom = (e) => {
      e.preventDefault();
      username = document.getElementById("username").value;
      // $("#firstpage").hide();
      // $("#chatroom").show();
    }

    var pubnub = new PubNub({
      publishKey: "pub-c-c42f11f2-1108-438a-ae06-bfe3787a8131",

      subscribeKey: "sub-c-ca7b08c8-67f5-11e9-81d5-56c3556875f9"
    });


    // Subscribe to the demo_tutorial channel pubnub
    pubnub.addListener({
      message: function (message) {
        let newMessage = document.createElement('p');
        newMessage.innerHTML = "From: " + message.message.from + "<br />" + message.message.message;
        document.getElementById("messages").appendChild(newMessage);
        // document.getElementById("message").innerHTML = message_array;
        // document.getElementById("publisher").innerHTML = message.message.from;
      }
    });

    pubnub.subscribe({
      channels: ["Labb 4"]
    });

    sendMessage = (e) => {
      // Publish a simple message to the “demo_tutorial” channel pubnub:
      e.preventDefault();
      // let from = document.getElementById("from").value;
      let message = document.getElementById("new-message").value;
      pubnub.publish({
        message: { "from": username, "message": message },
        channel: "Labb 4"
      });
    }
  </script>

  <script>
    var output = document.querySelector('.output');
    // // Get event data
    function deviceOrientationListener(event) {
      // var alpha = event.alpha; //z axis rotation [0,360)
      // var beta = event.beta; //x axis rotation [-180, 180]
      // var gamma = event.gamma; //y axis rotation [-90, 90]
      // output.innerHTML = alpha.toFixed([0]);
      // output.innerHTML = "utbytt";
      // let a = document.createElement('p');
      // a.innerHTML = "Change";
      // document.getElementById("test").appendChild(a);
    }

    if (window.DeviceOrientationEvent) {
      // alert("Works!");
      window.addEventListener("deviceorientation", function (event) {
        let element = document.getElementById("orientation");
        // var alpha = event.alpha; //z axis rotation [0,360)
        // var beta = event.beta; //x axis rotation [-180, 180]
        // var gamma = event.gamma; //y axis rotation [-90, 90]
        // output.innerHTML = alpha.toFixed([0]);
        // output.innerHTML = "Alpha: " + alpha + ", Beta: " + beta + ", Gamma: " + gamma;
        element.innerHTML = "Alpha: " + event.alpha.toFixed([0]) + "<br/> Beta: " + event.beta.toFixed([0]) + "<br/> Gamma: " + event.gamma.toFixed([0]);
        // alert("Alpha: " + event.alpha + "<br/> Beta: " + event.beta + "<br/> Gamma: " + event.gamma);
      }, true);

    } else {
      alert("Doesn't work!");
    }

  </script>


</head>

<body ontouchstart="">

  <!-- <p>This is the publisher:</p>
  <p id="publisher"></p>
  <p>This is the current messages:</p>
  <p id="message"></p> -->
  <div id="firstpage">
    <h1>Welcome to Chat Along</h1>
    <h2>You join channels by pointing your mobilephone towards specific directions. <i>North, </i><i>East,
      </i><i>South, </i><i>West</i></h2>
    <h4>Please enter username to start chatting</h4>
    <form onsubmit="enterChatroom(event)">
      <input type="text" placeholder="Enter username!" id="username" name="username" />
      <button type="submit">Select</button>
    </form>

    <button onclick="deviceOrientationListener(event)">Press me!</button>
    <p id=”heading”></p>
  </div>

  <div id="chatroom">
    <h2>Messages:</h2>
    <form onsubmit="sendMessage(event)">
      <!-- <input type="text" placeholder="Who is sending the message?" name="from" id="from" /> -->
      <input type="text" placeholder="Write message!" name="new-message" id="new-message" />
      <button type="submit">
        Send message!
      </button>
    </form>

    <div id="messageDiv">
      <p id="messages"></p>
    </div>
  </div>

  <script src="cordova.js"></script>
  <script src="libs/evothings/evothings.js"></script>
  <script src="libs/evothings/ui/ui.js"></script>
</body>

</html>